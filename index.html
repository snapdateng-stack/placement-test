```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Placement Test - Level Assessment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-orange: #E67E50;
            --primary-teal: #5DAEA8;
            --navy-blue: #2C3E50;
            --cream: #F5E6D3;
            --accent-green: #8BA888;
            --white: #FFFFFF;
            --light-gray: #F8F9FA;
            --medium-gray: #E0E0E0;
            --text-dark: #333333;
            --text-light: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary-teal) 0%, var(--navy-blue) 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-teal) 100%);
            color: var(--white);
            padding: 50px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .header h1 {
            font-size: 42px;
            margin-bottom: 15px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 18px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .progress-container {
            height: 8px;
            background: var(--medium-gray);
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-orange) 0%, var(--primary-teal) 100%);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--primary-orange);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .content {
            padding: 30px;
        }

        .timer {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--white);
            padding: 18px 28px;
            border-radius: 50px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            font-weight: 700;
            color: var(--navy-blue);
            z-index: 1000;
            display: none;
            font-size: 18px;
            border: 3px solid var(--primary-teal);
        }

        .timer.warning {
            background: var(--primary-orange);
            color: var(--white);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Welcome Screen */
        .welcome-content h2 {
            color: var(--navy-blue);
            font-size: 32px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, var(--cream) 0%, #FFF8EE 100%);
            border-left: 5px solid var(--primary-orange);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .info-card h3 {
            color: var(--primary-orange);
            margin-bottom: 15px;
            font-size: 20px;
        }

        .info-card ul {
            list-style: none;
            padding-left: 0;
        }

        .info-card li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            color: var(--text-dark);
        }

        .info-card li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--primary-teal);
            font-weight: 700;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--navy-blue);
            font-size: 16px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--medium-gray);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-teal);
            box-shadow: 0 0 0 4px rgba(93, 174, 168, 0.1);
        }

        .warning-card {
            background: linear-gradient(135deg, #FFF4E6 0%, #FFE8CC 100%);
            border-left: 5px solid var(--primary-orange);
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
        }

        /* Section Header */
        .section-header {
            background: linear-gradient(135deg, var(--navy-blue) 0%, var(--primary-teal) 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 35px;
            position: relative;
            overflow: hidden;
        }

        .section-header::before {
            content: '';
            position: absolute;
            top: -30px;
            right: -30px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .section-header h2 {
            font-size: 28px;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .section-header p {
            opacity: 0.95;
            font-size: 16px;
            position: relative;
            z-index: 1;
        }

        .level-indicator {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
            background: rgba(255,255,255,0.2);
        }

        /* Audio Player */
        .audio-player {
            background: linear-gradient(135deg, var(--light-gray) 0%, #E8F5F4 100%);
            border: 3px solid var(--primary-teal);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 35px;
            text-align: center;
        }

        .audio-player h3 {
            color: var(--navy-blue);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .audio-player audio {
            width: 100%;
            max-width: 600px;
            margin-top: 15px;
            border-radius: 50px;
        }

        .audio-instructions {
            color: var(--text-light);
            font-size: 14px;
            margin-top: 12px;
            font-style: italic;
        }

        /* Questions */
        .question {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid var(--primary-orange);
            transition: all 0.3s;
        }

        .question:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        .question-number {
            color: var(--primary-orange);
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .difficulty-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .difficulty-beginner {
            background: #D4EDDA;
            color: #155724;
        }

        .difficulty-intermediate {
            background: #FFF3CD;
            color: #856404;
        }

        .difficulty-advanced {
            background: #F8D7DA;
            color: #721C24;
        }

        .question-text {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: var(--navy-blue);
            line-height: 1.7;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 18px;
            background: var(--white);
            border: 3px solid var(--medium-gray);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .option:hover {
            border-color: var(--primary-teal);
            background: #F0FFFE;
            transform: translateX(5px);
        }

        .option input[type="radio"] {
            margin-right: 15px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--primary-teal);
        }

        .option label {
            cursor: pointer;
            flex: 1;
            font-size: 16px;
            color: var(--text-dark);
        }

        .option.selected {
            border-color: var(--primary-teal);
            background: linear-gradient(135deg, #E8F5F4 0%, #F0FFFE 100%);
            box-shadow: 0 4px 12px rgba(93, 174, 168, 0.2);
        }

        /* Reading Passage */
        .reading-passage {
            background: linear-gradient(135deg, var(--cream) 0%, #FFF8EE 100%);
            padding: 35px;
            border-radius: 15px;
            margin-bottom: 35px;
            border-left: 5px solid var(--accent-green);
            line-height: 1.8;
            font-size: 16px;
        }

        .reading-passage h3 {
            color: var(--navy-blue);
            margin-bottom: 20px;
            font-size: 22px;
        }

        .reading-passage p {
            margin-bottom: 18px;
            color: var(--text-dark);
        }

        .reading-passage .menu-box {
            background: var(--white);
            border: 2px solid var(--primary-orange);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        /* Writing Section */
        .writing-task {
            background: var(--light-gray);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 35px;
            border-left: 5px solid var(--primary-orange);
        }

        .writing-task h3 {
            color: var(--navy-blue);
            margin-bottom: 15px;
            font-size: 20px;
        }

        .writing-prompt {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-teal);
        }

        .writing-textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 3px solid var(--medium-gray);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
            line-height: 1.7;
        }

        .writing-textarea:focus {
            outline: none;
            border-color: var(--primary-teal);
            box-shadow: 0 0 0 4px rgba(93, 174, 168, 0.1);
        }

        .word-count {
            text-align: right;
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-light);
            font-weight: 600;
        }

        .word-count.warning {
            color: var(--primary-orange);
        }

        .word-count.success {
            color: var(--accent-green);
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 180px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-teal) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(230, 126, 80, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(230, 126, 80, 0.4);
        }

        .btn-secondary {
            background: var(--navy-blue);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: #1a252f;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Results Screen */
        .results-hero {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-teal) 100%);
            color: var(--white);
            padding: 50px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .results-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -10%;
            width: 400px;
            height: 400px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .results-hero h2 {
            font-size: 36px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .level-badge-large {
            display: inline-block;
            background: rgba(255,255,255,0.25);
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 28px;
            font-weight: 700;
            margin: 25px 0;
            position: relative;
            z-index: 1;
        }

        .score-display {
            font-size: 56px;
            font-weight: 700;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .percentage {
            font-size: 24px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Section Breakdown */
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .breakdown-card {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-top: 5px solid var(--primary-teal);
            transition: all 0.3s;
        }

        .breakdown-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .breakdown-card h3 {
            color: var(--navy-blue);
            font-size: 20px;
            margin-bottom: 20px;
        }

        .breakdown-score {
            font-size: 42px;
            font-weight: 700;
            color: var(--primary-orange);
            margin: 10px 0;
        }

        .breakdown-total {
            color: var(--text-light);
            font-size: 15px;
            margin-bottom: 15px;
        }

        .strength-bar-container {
            width: 100%;
            height: 10px;
            background: var(--medium-gray);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 15px;
        }

        .strength-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-orange) 0%, var(--primary-teal) 100%);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 5px;
        }

        .level-breakdown {
            text-align: left;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid var(--light-gray);
        }

        .level-breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }

        .level-breakdown-item .label {
            color: var(--text-light);
        }

        .level-breakdown-item .value {
            font-weight: 600;
            color: var(--navy-blue);
        }

        /* Recommendations */
        .recommendations-card {
            background: linear-gradient(135deg, var(--cream) 0%, #FFF8EE 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 40px 0;
            border-left: 5px solid var(--accent-green);
        }

        .recommendations-card h3 {
            color: var(--navy-blue);
            margin-bottom: 20px;
            font-size: 24px;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            padding: 15px 0;
            padding-left: 35px;
            position: relative;
            color: var(--text-dark);
            font-size: 16px;
        }

        .recommendation-list li::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: var(--primary-teal);
            font-weight: 700;
            font-size: 24px;
        }

        .next-steps {
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            margin-top: 25px;
            border: 3px solid var(--primary-teal);
        }

        .next-steps h4 {
            color: var(--navy-blue);
            margin-bottom: 15px;
        }

        .cta-button {
            display: inline-block;
            padding: 18px 40px;
            background: linear-gradient(135deg, var(--primary-teal) 0%, var(--accent-green) 100%);
            color: var(--white);
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s;
            font-size: 17px;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(93, 174, 168, 0.4);
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 60px;
        }

        .spinner {
            border: 5px solid var(--light-gray);
            border-top: 5px solid var(--primary-teal);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }
            
            .header {
                padding: 35px 25px;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .content {
                padding: 25px;
            }
            
            .timer {
                top: 15px;
                right: 15px;
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }

            .breakdown-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .timer, .btn, .button-group {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>üìö English Placement Test</h1>
        <p>Comprehensive Level Assessment ‚Ä¢ 44 Questions ‚Ä¢ ~45 minutes</p>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Timer -->
    <div class="timer" id="timer">
        ‚è±Ô∏è <span id="timeDisplay">50:00</span>
    </div>

    <div class="content">
        <!-- WELCOME SCREEN -->
        <div class="screen active" id="welcomeScreen">
            <div class="welcome-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <img src="logo.png" alt="SNAP DAT - —à–∫–æ–ª–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞" style="max-width: 200px; height: auto;">
                </div>
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é —É—Ä–æ–≤–Ω—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</h2>
                
                <div class="info-card">
                    <h3>üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞</h3>
                    <ul>
                        <li><strong>–ß–∞—Å—Ç—å 1: –ê—É–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> - 12 –≤–æ–ø—Ä–æ—Å–æ–≤</li>
                        <li><strong>–ß–∞—Å—Ç—å 2: –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</strong> - 18 –≤–æ–ø—Ä–æ—Å–æ–≤</li>
                        <li><strong>–ß–∞—Å—Ç—å 3: –ß—Ç–µ–Ω–∏–µ</strong> - 12 –≤–æ–ø—Ä–æ—Å–æ–≤</li>
                        <li><strong>–ß–∞—Å—Ç—å 4: –ü–∏—Å—å–º–æ</strong> - 2 –∑–∞–¥–∞–Ω–∏—è (80-150 —Å–ª–æ–≤ –∫–∞–∂–¥–æ–µ)</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label for="studentName">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                    <input type="text" id="studentName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –ø–æ–ª–Ω–æ–µ –∏–º—è" required>
                </div>

                <div class="form-group">
                    <label for="studentEmail">–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã *</label>
                    <input type="email" id="studentEmail" placeholder="your.email@example.com" required>
                </div>

                <div class="form-group">
                    <label for="studentAge">–í–æ–∑—Ä–∞—Å—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="number" id="studentAge" placeholder="–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç" min="5" max="100">
                </div>

                <div class="form-group">
                    <label for="studentNative">–†–æ–¥–Ω–æ–π —è–∑—ã–∫ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="studentNative" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†—É—Å—Å–∫–∏–π, –ò—Å–ø–∞–Ω—Å–∫–∏–π, –ê—Ä–∞–±—Å–∫–∏–π">
                </div>

                <div class="warning-card">
                    <h3>‚ö†Ô∏è –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç–µ—Å—Ç–∞</h3>
                    <ul>
                        <li>–ù–∞–π–¥–∏—Ç–µ —Ç–∏—Ö–æ–µ –º–µ—Å—Ç–æ —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—É—à–Ω–∏–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤—É–∫–∞</li>
                        <li>–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–≤–∞—Ä—å –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫</li>
                        <li>–í—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å –ø–∞—É–∑—ã –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏</li>
                        <li>–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
                    </ul>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="startTest()">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç üöÄ</button>
                </div>
            </div>
        </div>

        <!-- TEST SECTIONS (will be dynamically inserted) -->
        <div id="testContainer"></div>

        <!-- RESULTS SCREEN -->
        <div class="screen" id="resultsScreen">
            <div class="results-hero">
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="logo.png" alt="SNAP DAT" style="max-width: 150px; height: auto;">
                </div>
                <h2>üéâ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
                <div class="level-badge-large" id="levelBadge">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="score-display" id="totalScore">0/84</div>
                <div class="percentage">–ë–∞–ª–ª—ã: <span id="percentageScore">0</span>%</div>
            </div>

            <div class="breakdown-grid">
                <!-- Listening Card -->
                <div class="breakdown-card">
                    <h3>üéß –ê—É–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                    <div class="breakdown-score" id="listeningScore">0</div>
                    <div class="breakdown-total">–∏–∑ 18 –±–∞–ª–ª–æ–≤</div>
                    <div class="strength-bar-container">
                        <div class="strength-bar-fill" id="listeningBar" style="width: 0%"></div>
                    </div>
                    <div class="level-breakdown">
                        <div class="level-breakdown-item">
                            <span class="label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="listening-beginner">0/4</span>
                        </div>
                        <div class="level-breakdown-item">
                            <span class="label">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="listening-intermediate">0/4</span>
                        </div>
                        <div class="level-breakdown-item">
                            <span class="label">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="listening-advanced">0/4</span>
                        </div>
                    </div>
                </div>

                <!-- Grammar Card -->
                <div class="breakdown-card">
                    <h3>‚úèÔ∏è –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h3>
                    <div class="breakdown-score" id="grammarScore">0</div>
                    <div class="breakdown-total">–∏–∑ 36 –±–∞–ª–ª–æ–≤</div>
                    <div class="strength-bar-container">
                        <div class="strength-bar-fill" id="grammarBar" style="width: 0%"></div>
                    </div>
                    <div class="level-breakdown">
                        <div class="level-breakdown-item">
                            <span class="label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="grammar-beginner">0/6</span>
                        </div>
                        <div class="level-breakdown-item">
                            <span class="label">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="grammar-intermediate">0/6</span>
                        </div>
                        <div class="level-breakdown-item">
                            <span class="label">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="grammar-advanced">0/6</span>
                        </div>
                    </div>
                </div>

                <!-- Reading Card -->
                <div class="breakdown-card">
                    <h3>üìñ –ß—Ç–µ–Ω–∏–µ</h3>
                    <div class="breakdown-score" id="readingScore">0</div>
                    <div class="breakdown-total">–∏–∑ 18 –±–∞–ª–ª–æ–≤</div>
                    <div class="strength-bar-container">
                        <div class="strength-bar-fill" id="readingBar" style="width: 0%"></div>
                    </div>
                    <div class="level-breakdown">
                        <div class="level-breakdown-item">
                            <span class="label">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="reading-beginner">0/4</span>
                        </div>
                        <div class="level-breakdown-item">
                            <span class="label">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="reading-intermediate">0/4</span>
                        </div>
                        <div class="level-breakdown-item">
                            <span class="label">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
                            <span class="value" id="reading-advanced">0/4</span>
                        </div>
                    </div>
                </div>
            </div>
            
<!-- Recommendations Card -->
<div class="recommendations-card">
    <h3>üìö –í–∞—à –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è</h3>
    <div id="recommendations"></div>
    
    <!-- SEND TO TEACHER BUTTON -->
    <div class="button-group" style="margin: 30px 0; justify-content: center;">
        <button class="btn btn-primary" onclick="exportToGoogleSheets()" style="max-width: 400px;">
            üìä –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é
        </button>
    </div>
    
    <div class="next-steps">
        <h4>üìÖ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</h4>
        <ul class="recommendation-list">
            <li>–í–∞—à –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–∞—à–∏ –ø–∏—Å—å–º–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤</li>
            <li>–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —É—Å—Ç–Ω–æ–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤</li>
            <li>–ü–æ–ª—É—á–∏—Ç–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫—É—Ä—Å—É</li>
        </ul>
    </div>
</div>

<!-- SINGLE SIGN-UP BUTTON -->
<div class="button-group" style="justify-content: center;">
    <a href="https://t.me/tyveric" class="btn btn-primary" target="_blank" 
       style="text-decoration: none; text-align: center; max-width: 300px;">
       üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Ä–æ–∫
    </a>
</div>

<script>
// ==================== CONFIGURATION ====================
// Edit these values to customize your test

const CONFIG = {
    // Google Form URL for automatic submission
    GOOGLE_FORM_URL: 'https://docs.google.com/forms/d/e/1FAIpQLSeXpGO7frfmRq1I1QmoDUUmj7kolKaHfh-s3smqWcTSrtIwlg/formResponse',
    
    // OpenAI API - DO NOT put your key here if repo is public!
    // For AI grading, use a private repo or backend server
    OPENAI_API_KEY: '',
    USE_AI_GRADING: false,
    
    // Teacher email for notifications
    TEACHER_EMAIL: 'snapdateng@gmail.com',
    
    // Telegram link for scheduling lessons
    TELEGRAM_URL: 'https://t.me/tyveric',
    
    // School name
    SCHOOL_NAME: 'SNAP DAT - —à–∫–æ–ª–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞'
};

// ==================== TEST DATA ====================

const testData = {
    listening: {
        title: "Part 1: Listening",
        subtitle: "Listen carefully to each recording and answer the questions",
        icon: "üéß",
        questions: [
            // BEGINNER (A1-A2) - 4 questions, 1 point each
            {
                id: 1,
                level: "beginner",
                points: 1,
                audio: "EPT-Listening-A.mp3",
                audioTitle: "üõí Listening A: Grocery Store Conversation",
                text: "Where does the conversation take place?",
                options: [
                    { value: "a", text: "in a shopping mall" },
                    { value: "b", text: "in a restaurant" },
                    { value: "c", text: "in a hair salon" },
                    { value: "d", text: "in a grocery store" }
                ],
                correct: "d"
            },
            {
                id: 2,
                level: "beginner",
                points: 1,
                audio: "EPT-Listening-A.mp3",
                audioTitle: "üõí Listening A: Grocery Store Conversation",
                text: "Where does the woman find the butter?",
                options: [
                    { value: "a", text: "at the back of the store" },
                    { value: "b", text: "in aisle 4" },
                    { value: "c", text: "in the health food section" },
                    { value: "d", text: "near the health and beauty supplies" }
                ],
                correct: "a"
            },
            {
                id: 3,
                level: "beginner",
                points: 1,
                audio: "EPT-Listening-A.mp3",
                audioTitle: "üõí Listening A: Grocery Store Conversation",
                text: "What does the woman NOT need?",
                options: [
                    { value: "a", text: "butter" },
                    { value: "b", text: "shampoo" },
                    { value: "c", text: "fruit and vegetables" },
                    { value: "d", text: "help finding things" }
                ],
                correct: "c"
            },
            {
                id: 4,
                level: "beginner",
                points: 1,
                audio: "EPT-Listening-A.mp3",
                audioTitle: "üõí Listening A: Grocery Store Conversation",
                text: "What aisle number is mentioned in the conversation?",
                options: [
                    { value: "a", text: "Aisle 2" },
                    { value: "b", text: "Aisle 3" },
                    { value: "c", text: "Aisle 4" },
                    { value: "d", text: "Aisle 5" }
                ],
                correct: "c"
            },
            // INTERMEDIATE (B1) - 4 questions, 2 points each
            {
                id: 5,
                level: "intermediate",
                points: 2,
                audio: "EPT-Listening-B-AP.mp3",
                audioTitle: "üì∞ Listening B: News Report",
                text: "Where exactly did the earthquake strike?",
                options: [
                    { value: "a", text: "in the capital of South Carolina" },
                    { value: "b", text: "northeast of the capital of North Carolina" },
                    { value: "c", text: "northeast of the capital of South Carolina" },
                    { value: "d", text: "in a South American country" }
                ],
                correct: "c"
            },
            {
                id: 6,
                level: "intermediate",
                points: 2,
                audio: "EPT-Listening-B-AP.mp3",
                audioTitle: "üì∞ Listening B: News Report",
                text: "According to the report, what did many people do after they felt the earthquake?",
                options: [
                    { value: "a", text: "They went outside to investigate" },
                    { value: "b", text: "They posted about it on social media" },
                    { value: "c", text: "They called first responders" },
                    { value: "d", text: "They turned on the TV" }
                ],
                correct: "b"
            },
            {
                id: 7,
                level: "intermediate",
                points: 2,
                audio: "EPT-Listening-B-AP.mp3",
                audioTitle: "üì∞ Listening B: News Report",
                text: "What did geophysicists say to people in South Carolina?",
                options: [
                    { value: "a", text: "They likely won't experience another earthquake for a few years" },
                    { value: "b", text: "They should expect smaller aftershocks in the next few weeks" },
                    { value: "c", text: "They should prepare for a bigger earthquake in the next month" },
                    { value: "d", text: "Their homes will likely shake for many months to come" }
                ],
                correct: "b"
            },
            {
                id: 8,
                level: "intermediate",
                points: 2,
                audio: "EPT-Listening-B-AP.mp3",
                audioTitle: "üì∞ Listening B: News Report",
                text: "What time did the earthquake occur?",
                options: [
                    { value: "a", text: "around 1:30 in the morning" },
                    { value: "b", text: "around 1:30 in the afternoon" },
                    { value: "c", text: "at exactly 12:30 am" },
                    { value: "d", text: "The time is not mentioned" }
                ],
                correct: "a"
            },
            // ADVANCED (B2-C1) - 4 questions, 3 points each
            {
                id: 9,
                level: "advanced",
                points: 3,
                audio: "EPT-Listening-C.mp3",
                audioTitle: "üéì Listening C: Academic Lecture",
                text: "What is the recording mainly about?",
                options: [
                    { value: "a", text: "fifth-century English tribes" },
                    { value: "b", text: "the usage and origins of the English language" },
                    { value: "c", text: "the population of modern-day Europe" },
                    { value: "d", text: "how many words there are in English" }
                ],
                correct: "b"
            },
            {
                id: 10,
                level: "advanced",
                points: 3,
                audio: "EPT-Listening-C.mp3",
                audioTitle: "üéì Listening C: Academic Lecture",
                text: "Finish this sentence: English is used in one way or another by...",
                options: [
                    { value: "a", text: "one-quarter of the world's population" },
                    { value: "b", text: "about one million people" },
                    { value: "c", text: "more than two billion people" },
                    { value: "d", text: "billions of people in 15 countries" }
                ],
                correct: "c"
            },
            {
                id: 11,
                level: "advanced",
                points: 3,
                audio: "EPT-Listening-C.mp3",
                audioTitle: "üéì Listening C: Academic Lecture",
                text: "Which of the following is true about the Angles, Saxons, and Jutes?",
                options: [
                    { value: "a", text: "They spoke Celtic, which eventually evolved into English" },
                    { value: "b", text: "They spoke a Germanic language and brought it to the British Isles" },
                    { value: "c", text: "They traveled from India to the North Sea and learned English on their travels" },
                    { value: "d", text: "They invaded Britain and forced the local tribes to learn Danish" }
                ],
                correct: "b"
            },
            {
                id: 12,
                level: "advanced",
                points: 3,
                audio: "EPT-Listening-C.mp3",
                audioTitle: "üéì Listening C: Academic Lecture",
                text: "According to the lecture, when can the origins of English be traced back to?",
                options: [
                    { value: "a", text: "the third century AD" },
                    { value: "b", text: "the fifth century AD" },
                    { value: "c", text: "the seventh century AD" },
                    { value: "d", text: "during the Roman Empire" }
                ],
                correct: "b"
            }
        ]
    },

    grammar: {
        title: "Part 2: Grammar",
        subtitle: "Choose the correct answer for each question",
        icon: "‚úèÔ∏è",
        questions: [
            // BEGINNER (A1-A2) - 6 questions, 1 point each
            {
                id: 13,
                level: "beginner",
                points: 1,
                text: "We have _____ dog.",
                options: [
                    { value: "a", text: "dog" },
                    { value: "b", text: "a dogs" },
                    { value: "c", text: "an dog" },
                    { value: "d", text: "a dog" }
                ],
                correct: "d"
            },
            {
                id: 14,
                level: "beginner",
                points: 1,
                text: "She _____ breakfast right now.",
                options: [
                    { value: "a", text: "eat" },
                    { value: "b", text: "eats" },
                    { value: "c", text: "ate" },
                    { value: "d", text: "is eating" }
                ],
                correct: "d"
            },
            {
                id: 15,
                level: "beginner",
                points: 1,
                text: "Class starts _____ 9:00 am.",
                options: [
                    { value: "a", text: "on" },
                    { value: "b", text: "at" },
                    { value: "c", text: "in" },
                    { value: "d", text: "to" }
                ],
                correct: "b"
            },
            {
                id: 16,
                level: "beginner",
                points: 1,
                text: "The baker _____ 50 loaves of bread yesterday.",
                options: [
                    { value: "a", text: "made" },
                    { value: "b", text: "makes" },
                    { value: "c", text: "is making" },
                    { value: "d", text: "make" }
                ],
                correct: "a"
            },
            {
                id: 17,
                level: "beginner",
                points: 1,
                text: "My parents _____ to the bank tomorrow.",
                options: [
                    { value: "a", text: "goes" },
                    { value: "b", text: "went" },
                    { value: "c", text: "will go" },
                    { value: "d", text: "is going to go" }
                ],
                correct: "c"
            },
            {
                id: 18,
                level: "beginner",
                points: 1,
                text: "She has a _____ dress.",
                options: [
                    { value: "a", text: "beautiful red" },
                    { value: "b", text: "red beautiful" },
                    { value: "c", text: "beautifully red" },
                    { value: "d", text: "red beauty" }
                ],
                correct: "a"
            },
            // INTERMEDIATE (B1) - 6 questions, 2 points each
            {
                id: 19,
                level: "intermediate",
                points: 2,
                text: "I _____ this movie before. It's really good!",
                options: [
                    { value: "a", text: "see" },
                    { value: "b", text: "saw" },
                    { value: "c", text: "have seen" },
                    { value: "d", text: "am seeing" }
                ],
                correct: "c"
            },
            {
                id: 20,
                level: "intermediate",
                points: 2,
                text: "You _____ wear a seatbelt while driving. It's the law.",
                options: [
                    { value: "a", text: "can" },
                    { value: "b", text: "should" },
                    { value: "c", text: "must" },
                    { value: "d", text: "might" }
                ],
                correct: "c"
            },
            {
                id: 21,
                level: "intermediate",
                points: 2,
                text: "This book _____ by millions of people around the world.",
                options: [
                    { value: "a", text: "reads" },
                    { value: "b", text: "is read" },
                    { value: "c", text: "was read" },
                    { value: "d", text: "has read" }
                ],
                correct: "c"
            },
            {
                id: 22,
                level: "intermediate",
                points: 2,
                text: "If it _____ tomorrow, we'll stay home and watch movies.",
                options: [
                    { value: "a", text: "will rain" },
                    { value: "b", text: "rains" },
                    { value: "c", text: "rained" },
                    { value: "d", text: "would rain" }
                ],
                correct: "b"
            },
            {
                id: 23,
                level: "intermediate",
                points: 2,
                text: "This is _____ building in the city.",
                options: [
                    { value: "a", text: "the tall" },
                    { value: "b", text: "taller" },
                    { value: "c", text: "the tallest" },
                    { value: "d", text: "most tall" }
                ],
                correct: "c"
            },
            {
                id: 24,
                level: "intermediate",
                points: 2,
                text: "I enjoy _____ books in my free time.",
                options: [
                    { value: "a", text: "read" },
                    { value: "b", text: "to read" },
                    { value: "c", text: "reading" },
                    { value: "d", text: "reads" }
                ],
                correct: "c"
            },
            // ADVANCED (B2-C1) - 6 questions, 3 points each
            {
                id: 25,
                level: "advanced",
                points: 3,
                text: "When she arrived at the station, she realized she _____ her wallet at home.",
                options: [
                    { value: "a", text: "left" },
                    { value: "b", text: "has left" },
                    { value: "c", text: "had left" },
                    { value: "d", text: "was leaving" }
                ],
                correct: "c"
            },
            {
                id: 26,
                level: "advanced",
                points: 3,
                text: "If you _____ harder last year, you would have passed the exam.",
                options: [
                    { value: "a", text: "studied" },
                    { value: "b", text: "had studied" },
                    { value: "c", text: "have studied" },
                    { value: "d", text: "would study" }
                ],
                correct: "b"
            },
            {
                id: 27,
                level: "advanced",
                points: 3,
                text: "It is essential that each participant _____ the form before the meeting.",
                options: [
                    { value: "a", text: "fills out" },
                    { value: "b", text: "filled out" },
                    { value: "c", text: "fill out" },
                    { value: "d", text: "will fill out" }
                ],
                correct: "c"
            },
            {
                id: 28,
                level: "advanced",
                points: 3,
                text: "_____ had I arrived at the party than it started raining heavily.",
                options: [
                    { value: "a", text: "As soon as" },
                    { value: "b", text: "No sooner" },
                    { value: "c", text: "Hardly" },
                    { value: "d", text: "After" }
                ],
                correct: "b"
            },
            {
                id: 29,
                level: "advanced",
                points: 3,
                text: "_____ exhausted after the long journey, she still managed to attend the meeting.",
                options: [
                    { value: "a", text: "Being" },
                    { value: "b", text: "Been" },
                    { value: "c", text: "Having" },
                    { value: "d", text: "Was" }
                ],
                correct: "a"
            },
            {
                id: 30,
                level: "advanced",
                points: 3,
                text: "_____ surprised me was his complete lack of interest in the proposal.",
                options: [
                    { value: "a", text: "That" },
                    { value: "b", text: "What" },
                    { value: "c", text: "Which" },
                    { value: "d", text: "It" }
                ],
                correct: "b"
            }
        ]
    },

    reading: {
        title: "Part 3: Reading Comprehension",
        subtitle: "Read the passages and answer the questions",
        icon: "üìñ",
        passages: [
            // BEGINNER (A1-A2) - Menu reading
            {
                level: "beginner",
                title: "Sandy's Breakfast Menu",
                content: `
                    <div class="menu-box">
                        <h3 style="text-align: center; color: var(--primary-orange);">üçΩÔ∏è Sandy's Breakfast Menu</h3>
                        <p style="text-align: center; font-style: italic; margin-bottom: 20px;">(Available Mon‚ÄìFri, 7‚Äì11:30 am)</p>
                        
                        <h4>Sides</h4>
                        <p>Toast with jam or honey ................. $1.99</p>
                        <p>Home fries ........................................ $2.50</p>
                        <p>Bacon or sausage (3) ....................... $3.50</p>
                        
                        <h4>$5.99 Breakfast Specials</h4>
                        <p>#1 2 eggs and meat with home fries</p>
                        <p>#2 Cheese omelet with toast</p>
                        <p>#3 Pancakes (4)</p>
                        <p>#4 French toast (3 slices)</p>
                        
                        <h4>Beverages</h4>
                        <p>Coffee or tea ..................................... $2.00</p>
                        <p>Orange or apple juice ..................... $3.50</p>
                        
                        <p style="font-style: italic; margin-top: 15px;">Ask your server for our full menu.</p>
                    </div>
                `,
                questions: [
                    {
                        id: 31,
                        level: "beginner",
                        points: 1,
                        text: "What type of information is this?",
                        options: [
                            { value: "a", text: "a recipe" },
                            { value: "b", text: "a breakfast menu" },
                            { value: "c", text: "a full menu" },
                            { value: "d", text: "a receipt" }
                        ],
                        correct: "b"
                    },
                    {
                        id: 32,
                        level: "beginner",
                        points: 1,
                        text: "What is the name of the restaurant?",
                        options: [
                            { value: "a", text: "The information is not available" },
                            { value: "b", text: "Breakfast Menu" },
                            { value: "c", text: "Sides" },
                            { value: "d", text: "Sandy's" }
                        ],
                        correct: "d"
                    },
                    {
                        id: 33,
                        level: "beginner",
                        points: 1,
                        text: "Which two items cost the same price?",
                        options: [
                            { value: "a", text: "home fries and toast" },
                            { value: "b", text: "French toast and bacon" },
                            { value: "c", text: "coffee and tea" },
                            { value: "d", text: "apple juice and pancakes" }
                        ],
                        correct: "c"
                    },
                    {
                        id: 34,
                        level: "beginner",
                        points: 1,
                        text: "How much does Breakfast Special #1 cost?",
                        options: [
                            { value: "a", text: "$3.50" },
                            { value: "b", text: "$4.99" },
                            { value: "c", text: "$5.99" },
                            { value: "d", text: "$6.99" }
                        ],
                        correct: "c"
                    }
                ]
            },
            // INTERMEDIATE (B1) - Narrative text
            {
                level: "intermediate",
                title: "Yuko in Montreal",
                content: `
                    <h3>Yuko in Montreal</h3>
                    <p>Yuko moved to Montreal this year. She has lived in Montreal for about eight months. When she moved to Montreal from Tokyo, she was a little nervous and scared, but now she feels very comfortable and knows the city very well. She has found a nice apartment downtown, and it's not too expensive. She has found a job teaching Japanese, and she likes it a lot. She's also seen a lot of places and done a lot of things in Montreal. For example, Yuko has been to Mount Royal, she has ridden on the Metro, she's eaten a Montreal bagel, and she's met a cute Montreal man.</p>
                    
                    <p>Yuko has also learned a lot of French and improved her English. She has made a lot of friends, too. Some of her friends are from Montreal, but some of them have recently moved to Montreal just like Yuko. She has been to many restaurants on Saint Laurent Street. She has also joined a jazz band. Yuko plays piano in the band. She has taken many photographs of Montreal since she arrived. She likes the brightly painted houses. She has visited many museums and art galleries. She has even survived the cold Montreal winter! She has fallen in love with the city and all its charms.</p>
                `,
                questions: [
                    {
                        id: 35,
                        level: "intermediate",
                        points: 2,
                        text: "How did Yuko feel when she first moved to Montreal?",
                        options: [
                            { value: "a", text: "excited" },
                            { value: "b", text: "anxious" },
                            { value: "c", text: "angry" },
                            { value: "d", text: "comfortable" }
                        ],
                        correct: "b"
                    },
                    {
                        id: 36,
                        level: "intermediate",
                        points: 2,
                        text: "What does Yuko do for a living?",
                        options: [
                            { value: "a", text: "She rides the Metro" },
                            { value: "b", text: "She takes photographs" },
                            { value: "c", text: "She teaches Japanese" },
                            { value: "d", text: "She visits museums" }
                        ],
                        correct: "c"
                    },
                    {
                        id: 37,
                        level: "intermediate",
                        points: 2,
                        text: "What can be inferred about Yuko?",
                        options: [
                            { value: "a", text: "She likes music" },
                            { value: "b", text: "She loves cold weather" },
                            { value: "c", text: "She has a car" },
                            { value: "d", text: "She doesn't speak English" }
                        ],
                        correct: "a"
                    },
                    {
                        id: 38,
                        level: "intermediate",
                        points: 2,
                        text: "Which of the following has Yuko NOT done in Montreal?",
                        options: [
                            { value: "a", text: "Visited Mount Royal" },
                            { value: "b", text: "Eaten Montreal bagels" },
                            { value: "c", text: "Learned to speak French fluently" },
                            { value: "d", text: "Joined a jazz band" }
                        ],
                        correct: "c"
                    }
                ]
            },
            // ADVANCED (B2-C1) - Analytical text
            {
                level: "advanced",
                title: "Influencers",
                content: `
                    <h3>Influencers</h3>
                    <p>An influencer is a person who generates interest in something by posting about it on social media. Influencers are found across networking sites such as Instagram, TikTok, YouTube, and Twitter. They are often experts in a certain industry and have a large audience. Influencers encourage people to buy products, and they often promote companies, causes, and ideas through their social media channels.</p>
                    
                    <p>Influencers are categorized according to the number of followers they have on a single social media platform. A mega-influencer is someone who has more than one million followers. Macro-influencers have somewhere between 10,000 and one million followers, and micro-influencers have between 1,000 and 10,000 followers.</p>
                    
                    <p>Many companies work with influencers to sell their products. This is called influencer marketing. Fashion, beauty, food, travel, fitness, and technology are some of the most common industries to make use of influencers. Popular influencers such as Huda Kattan (beauty), Gigi Hadid (fashion), and Salt Bae (food) have over 50 million followers each on social media. Working with influencers can give brands huge reach and help them stand out in the crowded digital marketplace.</p>
                `,
                questions: [
                    {
                        id: 39,
                        level: "advanced",
                        points: 3,
                        text: "Which verb or phrase does NOT describe what influencers do?",
                        options: [
                            { value: "a", text: "lead to believe" },
                            { value: "b", text: "persuade" },
                            { value: "c", text: "convince" },
                            { value: "d", text: "discourage" }
                        ],
                        correct: "d"
                    },
                    {
                        id: 40,
                        level: "advanced",
                        points: 3,
                        text: "Which statement is true?",
                        options: [
                            { value: "a", text: "Huda Kattan is a macro-influencer" },
                            { value: "b", text: "Both Gigi Hadid and Huda Kattan are mega-influencers" },
                            { value: "c", text: "Salt Bae needs more followers to be a mega-influencer" },
                            { value: "d", text: "Gigi Hadid is a mega-influencer, but Huda Kattan is not" }
                        ],
                        correct: "b"
                    },
                    {
                        id: 41,
                        level: "advanced",
                        points: 3,
                        text: "Why do companies like to hire influencers?",
                        options: [
                            { value: "a", text: "Influencers have strong opinions" },
                            { value: "b", text: "Influencers can get a company noticed" },
                            { value: "c", text: "Influencers have a marketing degree" },
                            { value: "d", text: "Influencers like to be categorized" }
                        ],
                        correct: "b"
                    },
                    {
                        id: 42,
                        level: "advanced",
                        points: 3,
                        text: "Based on the article, what can be inferred about influencer marketing?",
                        options: [
                            { value: "a", text: "It only works for fashion and beauty products" },
                            { value: "b", text: "It's more effective than traditional advertising in crowded markets" },
                            { value: "c", text: "It requires influencers to have exactly one million followers" },
                            { value: "d", text: "It's a new concept that started in 2020" }
                        ],
                        correct: "b"
                    }
                ]
            }
        ]
    },

    writing: {
        title: "Part 4: Writing",
        subtitle: "Complete both writing tasks. Take your time and write carefully.",
        icon: "‚úçÔ∏è",
        tasks: [
            {
                id: "writing1",
                level: "beginner-intermediate",
                title: "Task 1: Describe Your Daily Routine",
                prompt: "Write about your typical day. What time do you wake up? What do you do during the day? What do you do during the evening? Use present simple tense.",
                wordCountMin: 80,
                wordCountMax: 120,
                placeholder: "I usually wake up at...",
                rubric: [
                    "Uses present simple correctly",
                    "Includes time expressions",
                    "Uses basic connectors (first, then, after)",
                    "Appropriate vocabulary",
                    "Clear organization"
                ]
            },
            {
                id: "writing2",
                level: "intermediate-advanced",
                title: "Task 2: Opinion Essay",
                prompt: "Some people think that social media has more disadvantages than advantages. Do you agree or disagree? Give reasons and examples to support your opinion.",
                wordCountMin: 120,
                wordCountMax: 180,
                placeholder: "In my opinion...",
                rubric: [
                    "Clear opinion/thesis statement",
                    "Well-organized paragraphs",
                    "Uses complex sentences",
                    "Appropriate linking words (however, therefore, although)",
                    "Academic vocabulary",
                    "Grammar accuracy"
                ]
            }
        ]
    }
};

// ==================== STATE MANAGEMENT ====================

const STATE_KEY = 'placementTestState';

let currentState = {
    currentSection: 0,
    currentQuestion: 0,
    answers: {},
    writingAnswers: {},
    studentInfo: {},
    startTime: null,
    timeRemaining: 3000 // 50 minutes in seconds
};

// Save state to localStorage
function saveState() {
    localStorage.setItem(STATE_KEY, JSON.stringify(currentState));
}

// Load state from localStorage
function loadState() {
    const saved = localStorage.getItem(STATE_KEY);
    if (saved) {
        currentState = JSON.parse(saved);
        return true;
    }
    return false;
}

// Clear saved state
function clearState() {
    localStorage.removeItem(STATE_KEY);
}

// ==================== INITIALIZATION ====================

window.addEventListener('DOMContentLoaded', () => {
    if (loadState() && currentState.studentInfo && currentState.studentInfo.name) {
        // Resume test - check if student info exists
        document.getElementById('welcomeScreen').classList.remove('active');
        generateSection();
        startTimer();
        updateProgress();
    }
    // Don't clear state automatically
});
    
    // Scroll to top
    window.scrollTo(0, 0);
});

// ==================== TEST FLOW ====================

function startTest() {
    // Validate student info
    const nameInput = document.getElementById('studentName');
    const emailInput = document.getElementById('studentEmail');
    
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    
    if (!name) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
        nameInput.focus();
        nameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }
    
    if (!email) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã');
        emailInput.focus();
        emailInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }
    
    if (!isValidEmail(email)) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã');
        emailInput.focus();
        emailInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }
    
    // Save student info
    currentState.studentInfo = {
        name: name,
        email: email,
        age: document.getElementById('studentAge').value,
        nativeLanguage: document.getElementById('studentNative').value,
        testDate: new Date().toISOString()
    };
    
    currentState.startTime = Date.now();
    
    // Hide welcome screen
    document.getElementById('welcomeScreen').classList.remove('active');
    
    // Start timer
    startTimer();
    
    // Generate first section
    generateSection();
    
    saveState();
}

function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function startTimer() {
    const timerEl = document.getElementById('timer');
    timerEl.style.display = 'block';
    
    const timerInterval = setInterval(() => {
        currentState.timeRemaining--;
        
        const minutes = Math.floor(currentState.timeRemaining / 60);
        const seconds = currentState.timeRemaining % 60;
        
        document.getElementById('timeDisplay').textContent = 
            `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        // Warning at 5 minutes
        if (currentState.timeRemaining <= 300) {
            timerEl.classList.add('warning');
        }
        
        // Auto-submit at 0
        if (currentState.timeRemaining <= 0) {
            clearInterval(timerInterval);
            alert('–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ! –í–∞—à —Ç–µ—Å—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
            finishTest();
        }
        
        saveState();
    }, 1000);
}

// ==================== SECTION GENERATION ====================

function generateSection() {
    const sections = ['listening', 'grammar', 'reading', 'writing'];
    const sectionName = sections[currentState.currentSection];
    const sectionData = testData[sectionName];
    
    const container = document.getElementById('testContainer');
    container.innerHTML = '';
    
    const section = document.createElement('div');
    section.className = 'screen active';
    section.id = `section-${sectionName}`;
    
    // Section header
    section.innerHTML = `
        <div class="section-header">
            <h2>${sectionData.icon} ${sectionData.title}</h2>
            <p>${sectionData.subtitle}</p>
            ${getSectionLevelIndicator(sectionName)}
        </div>
    `;
    
    // Generate questions based on section type
    if (sectionName === 'listening') {
        section.innerHTML += generateListeningQuestions(sectionData);
    } else if (sectionName === 'grammar') {
        section.innerHTML += generateGrammarQuestions(sectionData);
    } else if (sectionName === 'reading') {
        section.innerHTML += generateReadingQuestions(sectionData);
    } else if (sectionName === 'writing') {
        section.innerHTML += generateWritingTasks(sectionData);
    }
    
    // Navigation buttons
    section.innerHTML += generateNavigationButtons();
    
    container.appendChild(section);
    
    // Update progress
    updateProgress();
    
    // Restore previous answers
    restoreAnswers();
    
    // Add event listeners
    addEventListeners(sectionName);
    
    // Scroll to top
    window.scrollTo(0, 0);
    
    saveState();
}

function getSectionLevelIndicator(section) {
    return ''; // No level indicators shown to students
}

function generateListeningQuestions(data) {
    let html = '';
    let currentAudio = null;
    
    data.questions.forEach((q, index) => {
        // Add audio player when it changes
        if (q.audio !== currentAudio) {
            currentAudio = q.audio;
            html += `
                <div class="audio-player">
                    <h3>${q.audioTitle}</h3>
                    <audio controls controlsList="nodownload">
                        <source src="${q.audio}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                    <p class="audio-instructions">
                        üéß You can listen as many times as you need. Use headphones for best quality.
                    </p>
                </div>
            `;
        }
        
        html += generateQuestion(q, index + 1);
    });
    
    return html;
}

function generateGrammarQuestions(data) {
    let html = '';
    data.questions.forEach((q, index) => {
        html += generateQuestion(q, index + 1);
    });
    return html;
}

function generateReadingQuestions(data) {
    let html = '';
    
    data.passages.forEach(passage => {
        html += `
            <div class="reading-passage">
                ${passage.content}
            </div>
        `;
        
        passage.questions.forEach((q, index) => {
            html += generateQuestion(q, q.id - 30);
        });
    });
    
    return html;
}

function generateQuestion(q, displayNumber) {
    return `
        <div class="question" data-question-id="${q.id}">
            <div class="question-number">
                Question ${displayNumber}
            </div>
            <div class="question-text">${q.text}</div>
            <div class="options">
                ${q.options.map(opt => `
                    <div class="option" onclick="selectOption(${q.id}, '${opt.value}')">
                        <input type="radio" 
                               name="q${q.id}" 
                               value="${opt.value}" 
                               id="q${q.id}_${opt.value}">
                        <label for="q${q.id}_${opt.value}">${opt.value}) ${opt.text}</label>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function generateWritingTasks(data) {
    let html = '';
    
    data.tasks.forEach((task, index) => {
        html += `
            <div class="writing-task">
                <h3>${task.title}</h3>
                <div class="writing-prompt">
                    <strong>üìù Prompt:</strong> ${task.prompt}
                </div>
                <p style="color: var(--text-light); margin: 15px 0;">
                    <strong>Word count:</strong> ${task.wordCountMin}-${task.wordCountMax} words
                </p>
                <textarea 
                    class="writing-textarea"
                    id="${task.id}"
                    placeholder="${task.placeholder}"
                    oninput="updateWordCount('${task.id}', ${task.wordCountMin}, ${task.wordCountMax})"
                ></textarea>
                <div class="word-count" id="${task.id}-count">0 words</div>
            </div>
        `;
    });
    
    return html;
}

function generateNavigationButtons() {
    const sections = ['listening', 'grammar', 'reading', 'writing'];
    const isLastSection = currentState.currentSection === sections.length - 1;
    const isFirstSection = currentState.currentSection === 0;
    
    return `
        <div class="button-group">
            ${!isFirstSection ? '<button class="btn btn-secondary" onclick="previousSection()">‚Üê Previous Section</button>' : ''}
            ${!isLastSection ? 
                '<button class="btn btn-primary" onclick="nextSection()">Next Section ‚Üí</button>' :
                '<button class="btn btn-primary" onclick="finishTest()">Submit Test üéØ</button>'
            }
        </div>
    `;
}

// ==================== ANSWER HANDLING ====================

function selectOption(questionId, value) {
    currentState.answers[questionId] = value;
    
    // Visual feedback
    const questionDiv = document.querySelector(`[data-question-id="${questionId}"]`);
    const options = questionDiv.querySelectorAll('.option');
    
    options.forEach(opt => {
        opt.classList.remove('selected');
        if (opt.querySelector('input').value === value) {
            opt.classList.add('selected');
            opt.querySelector('input').checked = true;
        }
    });
    
    saveState();
}

function restoreAnswers() {
    // Restore multiple choice answers
    Object.keys(currentState.answers).forEach(qId => {
        const value = currentState.answers[qId];
        const radio = document.querySelector(`input[name="q${qId}"][value="${value}"]`);
        if (radio) {
            radio.checked = true;
            radio.closest('.option').classList.add('selected');
        }
    });
    
    // Restore writing answers
    Object.keys(currentState.writingAnswers).forEach(taskId => {
        const textarea = document.getElementById(taskId);
        if (textarea) {
            textarea.value = currentState.writingAnswers[taskId];
            updateWordCount(taskId, 0, 999); // Update word count
        }
    });
}

function updateWordCount(taskId, min, max) {
    const textarea = document.getElementById(taskId);
    const countEl = document.getElementById(`${taskId}-count`);
    
    const text = textarea.value.trim();
    const wordCount = text ? text.split(/\s+/).length : 0;
    
    // Save writing answer
    currentState.writingAnswers[taskId] = textarea.value;
    saveState();
    
    // Update display
    countEl.textContent = `${wordCount} words`;
    
    if (wordCount < min) {
        countEl.className = 'word-count warning';
    } else if (wordCount >= min && wordCount <= max) {
        countEl.className = 'word-count success';
    } else {
        countEl.className = 'word-count warning';
    }
}

// ==================== NAVIGATION ====================

function nextSection() {
    // Validate section completion (optional - you can make this stricter)
    const sections = ['listening', 'grammar', 'reading', 'writing'];
    const currentSectionName = sections[currentState.currentSection];
    
    if (currentSectionName === 'writing') {
        // Check if writing tasks have minimum words
        const task1 = document.getElementById('writing1').value.trim();
        const task2 = document.getElementById('writing2').value.trim();
        
        const count1 = task1 ? task1.split(/\s+/).length : 0;
        const count2 = task2 ? task2.split(/\s+/).length : 0;
        
        if (count1 < 80 || count2 < 120) {
            if (!confirm('–í–∞—à–∏ –ø–∏—Å—å–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∏–∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                return;
            }
        }
    }
    
    currentState.currentSection++;
    generateSection();
    window.scrollTo(0, 0);
    saveState();
}

function previousSection() {
    currentState.currentSection--;
    generateSection();
    window.scrollTo(0, 0);
    saveState();
}

function updateProgress() {
    const totalSections = 4;
    const progress = ((currentState.currentSection + 1) / totalSections) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
}

// ==================== RESULTS CALCULATION ====================

function calculateResults() {
    const results = {
        listening: { score: 0, max: 18, byLevel: { beginner: { score: 0, total: 4 }, intermediate: { score: 0, total: 4 }, advanced: { score: 0, total: 4 } } },
        grammar: { score: 0, max: 36, byLevel: { beginner: { score: 0, total: 6 }, intermediate: { score: 0, total: 6 }, advanced: { score: 0, total: 6 } } },
        reading: { score: 0, max: 18, byLevel: { beginner: { score: 0, total: 4 }, intermediate: { score: 0, total: 4 }, advanced: { score: 0, total: 4 } } },
        totalScore: 0,
        maxScore: 72,
        percentage: 0
    };
    
    // Score listening
    testData.listening.questions.forEach(q => {
        if (currentState.answers[q.id] === q.correct) {
            results.listening.score += q.points;
            results.listening.byLevel[q.level].score++;
        }
    });
    
    // Score grammar
    testData.grammar.questions.forEach(q => {
        if (currentState.answers[q.id] === q.correct) {
            results.grammar.score += q.points;
            results.grammar.byLevel[q.level].score++;
        }
    });
    
    // Score reading
    testData.reading.passages.forEach(passage => {
        passage.questions.forEach(q => {
            if (currentState.answers[q.id] === q.correct) {
                results.reading.score += q.points;
                results.reading.byLevel[q.level].score++;
            }
        });
    });
    
    // Calculate total
    results.totalScore = results.listening.score + results.grammar.score + results.reading.score;
    results.percentage = Math.round((results.totalScore / results.maxScore) * 100);
    
    return results;
}

function getPlacementLevel(percentage) {
    if (percentage < 17) return { level: "Pre-Beginner (A0)", elliiLevel: "Level 1", color: "#E67E50" };
    if (percentage < 31) return { level: "Beginner (A1)", elliiLevel: "Level 1-2", color: "#E67E50" };
    if (percentage < 46) return { level: "Elementary (A2)", elliiLevel: "Level 2-3", color: "#F4A261" };
    if (percentage < 61) return { level: "Low Intermediate (B1-)", elliiLevel: "Level 3-4", color: "#5DAEA8" };
    if (percentage < 76) return { level: "Intermediate (B1)", elliiLevel: "Level 4-5", color: "#5DAEA8" };
    if (percentage < 86) return { level: "High Intermediate (B1+/B2)", elliiLevel: "Level 5-6", color: "#2A9D8F" };
    return { level: "Advanced (B2+/C1)", elliiLevel: "Level 6-7", color: "#264653" };
}

function getRecommendations(results, placement) {
    const recommendations = [];
    
    // Analyze strengths and weaknesses
    const listeningPercent = (results.listening.score / results.listening.max) * 100;
    const grammarPercent = (results.grammar.score / results.grammar.max) * 100;
    const readingPercent = (results.reading.score / results.reading.max) * 100;
    
    // Overall recommendation - ONLY CEFR
    recommendations.push(`<strong>–£—Ä–æ–≤–µ–Ω—å CEFR:</strong> ${placement.level}`);
    
    // Specific skill recommendations in Russian
    if (listeningPercent < 50) {
        recommendations.push("–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ö –Ω–∞ –∞—É–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–∫–∞—Å—Ç–∞—Ö");
    }
    if (grammarPercent < 50) {
        recommendations.push("–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –æ—Å–Ω–æ–≤–∞–º–∏ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏");
    }
    if (readingPercent < 50) {
        recommendations.push("–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —á—Ç–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ –≤–∞—à–µ–º —É—Ä–æ–≤–Ω–µ");
    }
    
    // Level-specific advice in Russian
    if (results.percentage < 45) {
        recommendations.push("–£–∫—Ä–µ–ø–∏—Ç–µ –±–∞–∑–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–æ–∂–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º");
        recommendations.push("–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –±–∞–∑–æ–≤—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –∏ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—É—é –ª–µ–∫—Å–∏–∫—É");
    } else if (results.percentage < 75) {
        recommendations.push("–ì–æ—Ç–æ–≤—ã –∫ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º —Ç–µ–∫—Å—Ç–∞–º –∏ –¥–∏—Å–∫—É—Å—Å–∏—è–º");
        recommendations.push("–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ —Å–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ –∏ –∏–¥–∏–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π");
    } else {
        recommendations.push("–ë—Ä–æ—Å—å—Ç–µ —Å–µ–±–µ –≤—ã–∑–æ–≤ —Å –∞—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏");
        recommendations.push("–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ–±—â–µ–Ω–∏–µ–º");
    }
    
    return recommendations;
}

// ==================== AI WRITING ASSESSMENT ====================

async function assessWritingWithAI() {
    if (!CONFIG.USE_AI_GRADING || !CONFIG.OPENAI_API_KEY) {
        return null;
    }
    
    const writing1 = currentState.writingAnswers.writing1 || '';
    const writing2 = currentState.writingAnswers.writing2 || '';
    
    if (!writing1 || !writing2) {
        return null;
    }
    
    try {
        const assessment = await callOpenAI(writing1, writing2);
        return assessment;
    } catch (error) {
        console.error('AI assessment error:', error);
        return null;
    }
}

async function assessWritingWithAI() {
    const writing1 = currentState.writingAnswers.writing1 || '';
    const writing2 = currentState.writingAnswers.writing2 || '';
    
    if (!writing1 || !writing2) {
        return null;
    }
    
    try {
        const response = await fetch('/api/grade-writing', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                task1: writing1,
                task2: writing2
            })
        });
        
        if (!response.ok) {
            throw new Error('Failed to assess writing');
        }
        
        const assessment = await response.json();
        return assessment;
    } catch (error) {
        console.error('AI assessment error:', error);
        return null;
    }
}

// ==================== FINISH TEST ====================

function finishTest() {
    // Show loading in test container
    const container = document.getElementById('testContainer');
    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>–ü–æ–¥—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</p></div>';
    
    // Use setTimeout to allow UI to update
    setTimeout(() => {
        try {
            // Calculate results
            const results = calculateResults();
            const placement = getPlacementLevel(results.percentage);
            const recommendations = getRecommendations(results, placement);
            
            // Clear the loading spinner
            container.innerHTML = '';
            
            // Hide all sections
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            // Show results
            const resultsScreen = document.getElementById('resultsScreen');
            resultsScreen.classList.add('active');
            
            // Update results display
            document.getElementById('levelBadge').textContent = placement.level;
            document.getElementById('totalScore').textContent = `${results.totalScore}/${results.maxScore}`;
            document.getElementById('percentageScore').textContent = results.percentage;
            
            // Update section scores
            updateSectionScore('listening', results.listening);
            updateSectionScore('grammar', results.grammar);
            updateSectionScore('reading', results.reading);
            
            // Update recommendations
            let recHTML = '<ul class="recommendation-list">' +
                recommendations.map(rec => `<li>${rec}</li>`).join('') +
                '</ul>';
            document.getElementById('recommendations').innerHTML = recHTML;
            
            // Hide timer
            document.getElementById('timer').style.display = 'none';
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Save results
            currentState.results = results;
            currentState.placement = placement;
            saveState();
            
            // Clear state after finishing to allow restarting if needed
            clearState();
            
        } catch (error) {
            console.error('Error calculating results:', error);
            container.innerHTML = '<div class="error"><p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p></div>';
        }
    }, 1000);
}

function updateSectionScore(section, data) {
    document.getElementById(`${section}Score`).textContent = data.score;
    const percent = (data.score / data.max) * 100;
    document.getElementById(`${section}Bar`).style.width = `${percent}%`;
    
    // Update level breakdown
    Object.keys(data.byLevel).forEach(level => {
        const elem = document.getElementById(`${section}-${level}`);
        if (elem) {
            elem.textContent = `${data.byLevel[level].score}/${data.byLevel[level].total}`;
        }
    });
}

// ==================== EXPORT FUNCTIONS ====================
async function exportToGoogleSheets() {
    const exportData = {
        timestamp: new Date().toISOString(),
        studentInfo: currentState.studentInfo,
        results: currentState.results,
        placement: currentState.placement,
        answers: currentState.answers,
        writingAnswers: currentState.writingAnswers
    };
    
    // Show loading
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
    button.disabled = true;
    
    try {
        // Get AI assessment first
        const aiFeedback = await assessWritingWithAI();
        exportData.aiFeedback = aiFeedback;
        
        // Submit to Google Form
        if (CONFIG.GOOGLE_FORM_URL) {
            await submitToGoogleForm(exportData);
        }
        
        // Send email notification
        await fetch('/api/send-results', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(exportData)
        });
        
        // Show AI feedback on results page if available
        if (aiFeedback) {
            displayAIFeedback(aiFeedback);
        }
        
        alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.');
        
    } catch (error) {
        console.error('Submission error:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    } finally {
        button.textContent = originalText;
        button.disabled = false;
    }
}

function displayAIFeedback(aiFeedback) {
    // Add AI feedback section to results page
    const aiSection = `
        <div class="breakdown-card" style="grid-column: 1 / -1;">
            <h3>ü§ñ AI –û—Ü–µ–Ω–∫–∞ –ü–∏—Å—å–º–µ–Ω–Ω—ã—Ö –ó–∞–¥–∞–Ω–∏–π</h3>
            <div style="text-align: left;">
                <h4>–ó–∞–¥–∞–Ω–∏–µ 1: ${aiFeedback.task1?.score}/5</h4>
                <p><strong>–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞:</strong> ${aiFeedback.task1?.grammar}</p>
                <p><strong>–°–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å:</strong> ${aiFeedback.task1?.vocabulary}</p>
                
                <h4>–ó–∞–¥–∞–Ω–∏–µ 2: ${aiFeedback.task2?.score}/5</h4>
                <p><strong>–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞:</strong> ${aiFeedback.task2?.grammar}</p>
                <p><strong>–°–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å:</strong> ${aiFeedback.task2?.vocabulary}</p>
                
                <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${aiFeedback.recommendation}</p>
            </div>
        </div>
    `;
    
    const breakdownGrid = document.querySelector('.breakdown-grid');
    breakdownGrid.insertAdjacentHTML('beforeend', aiSection);
}

async function submitToGoogleForm(data) {
    // Google Form field mappings with actual entry IDs
    const formData = new FormData();
    
    formData.append('entry.936940614', data.studentInfo.name || '');
    formData.append('entry.38363323', data.studentInfo.email || '');
    formData.append('entry.308394169', data.studentInfo.age || 'Not provided');
    formData.append('entry.39515145', data.studentInfo.nativeLanguage || 'Not provided');
    formData.append('entry.540628309', new Date().toLocaleString('ru-RU'));
    formData.append('entry.837019120', `${data.results.totalScore}/${data.results.maxScore}`);
    formData.append('entry.961123626', data.results.percentage + '%');
    formData.append('entry.654985936', data.placement.level);
    formData.append('entry.447635218', `${data.results.listening.score}/18`);
    formData.append('entry.2108423620', `${data.results.grammar.score}/36`);
    formData.append('entry.956470450', `${data.results.reading.score}/18`);
    formData.append('entry.1080483481', data.writingAnswers.writing1 || 'Not completed');
    formData.append('entry.1827659829', data.writingAnswers.writing2 || 'Not completed');
    // Remove the answers field to avoid JSON string in the sheet
    // formData.append('entry.718946060', JSON.stringify(data.answers));
    
    // Submit to Google Form
    await fetch(CONFIG.GOOGLE_FORM_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
    });
    
    return true;
}

function addEventListeners(section) {
    // Add any section-specific event listeners here
}

</script>

</body>
</html>
```
